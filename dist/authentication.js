"use strict";angular.module("ChimpChangeAuthentication",["ngCookies"]).constant("Constant",{PREFIX:"https://authentication-api-test.chimpchange.me/authentication",IP_ADR_URL:"https://api.ipify.org?format=jsonp&callback=",USER:"/credentials",LOGOUT:"/logout",RESEND:"/resendCode",RESET:"/resetPassword",SECURITY:"/securityProfile",TWO_FACTOR:"/twoFactor",USER_ACCOUNT_TOKENS:"tokens",USER_ACCOUNT_INFO:"userAccount"}).factory("authentication",["$http","Constant","$q","$cookies",function(a,b,c,d){return{authenticateByCredentials:function(e){var f={deviceId:d.getObject("deviceId")||angular.noop(),pin:""},g=c.defer();return e=angular.merge(f,e),a.post(b.PREFIX,e).then(function(a){var c={data:a.data,headers:a.headers,status:a.status,statusText:a.statusText,config:a.config},e={deviceToken:a.data.deviceToken,token:a.data.token};d.putObject(b.USER_ACCOUNT_TOKENS,e),d.putObject(b.USER_ACCOUNT_INFO,a.data),g.resolve(c)},function(a){g.reject(a)}),g.promise},createUser:function(c){return a.post(b.PREFIX+b.USER,c)},getUserDetails:function(c){return a.get(b.PREFIX+b.USER+"/"+c)},updateUserDetail:function(c,d){return a.put(b.PREFIX+b.USER+"/"+c,d)},logout:function(c){return a.post(b.PREFIX+b.LOGOUT,c)},resendCode:function(){var c=d.getObject(b.USER_ACCOUNT_INFO).userId;return a.post(b.PREFIX+b.RESEND+"?userId="+c)},reset:function(c){return a.post(b.PREFIX+b.RESET,c)},getSecurityProfile:function(c){return a.get(b.PREFIX+b.SECURITY+"/"+c,{headers:{Accept:"application/json"}})},updateSecurityProfile:function(c,d){return a.put(b.PREFIX+b.SECURITY+"/"+c,d)},twoFactor:function(c){var e={userId:d.getObject(b.USER_ACCOUNT_INFO).userId,code:c.code};return a.post(b.PREFIX+b.TWO_FACTOR,e)}}}]).factory("authenticationInterceptor",["Constant","$cookies","SDKCache",function(a,b,c){return{request:function(d){var e,f,g=b.getObject("tokens")||angular.noop();return d.url!==a.IP_ADR_URL&&d.url.indexOf("authentication")>-1?(f=c.getIP(),e=b.getObject("deviceId")||angular.noop(),d.headers["Content-Type"]="application/json",d.headers.client="web",d.headers["X-Client-IP"]=f,d.url.indexOf("/authentication/resetPassword")>-1&&(d.headers.deviceId=e),g&&(d.headers.token=g.token,d.headers.deviceId=e)):d.url===a.IP_ADR_URL?d.headers.token=void 0:g&&(d.headers.token=g.token),d}}}]).config(["$httpProvider",function(a){a.interceptors.push("authenticationInterceptor")}]).factory("SDKCache",["$cacheFactory","$cookies",function(a,b){var c=a("cacheManager"),d="ipAdr";return{setIP:function(a){return b.putObject("client-ip",a),c.put(d,a)},getIP:function(){return c.get(d)}}}]).factory("DeviceID",["$cookies",function(a){var b,c,d="";return{SetDeviceID:function(){if(d=a.getObject("deviceId")||angular.noop(),!d)for(b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;c<14;c++)d+=b.charAt(Math.floor(Math.random()*b.length));a.putObject("deviceId",d)}}}]).run(["$http","SDKCache","DeviceID",function($http,SDKCache,DeviceID){DeviceID.SetDeviceID(),SDKCache.getIP()||$http.get("https://api.ipify.org?format=jsonp&callback=",{headers:{"Content-Type":"application/javascript",client:void 0,"X-Client-IP":void 0,token:void 0}}).then(function(res){var str=res.data;str=eval(str),SDKCache.setIP(str.ip)})}]);